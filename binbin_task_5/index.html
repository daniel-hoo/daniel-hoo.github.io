<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>IFE JavaScript Task 05</title>
    <link href="style.css" rel="stylesheet">
  </head>
  <body>
    <input type="text" id="input"><button type="button" id="left-in">左侧入</button><button type="button" id="right-in">右侧入</button><button type="button" id="left-out">左侧出</button><button type="button" id="right-out">右侧出</button>
    <button type="button" id="sort">排序</button>
    <ul id="queue"></ul>
    <script>
      var input = document.getElementById("input");
      var leftIn = document.getElementById("left-in");
      var rightIn = document.getElementById("right-in");
      var leftOut = document.getElementById("left-out");
      var rightOut = document.getElementById("right-out");
      var queue = document.getElementById("queue");
      var sort = document.getElementById("sort");
      var isSorted = false;
      
      function queueIn(side, element) {
        if(queue.childElementCount >= 60) {
          alert("队列元素个数最多为60！");
          return;
        }
        var li = document.createElement("li");
        li.style.height = element + "px";
        li.style.top = (100 - parseInt(element)) + "px";
        li.onclick = function() {
          queue.removeChild(this);
        }
        if(side === "left") {
          queue.insertBefore(li, queue.firstChild);
        }else if(side === "right") {
          queue.appendChild(li);
        }
        isSorted = false;
      }
      
      function queueOut(side) {
        if(queue.childElementCount > 0) {
          if(side === "left") {
            alert(queue.removeChild(queue.firstChild).style.height.slice(0, -2));
          }else if(side === "right") {
            alert(queue.removeChild(queue.lastChild).style.height.slice(0, -2));
          }
        }else {
          alert("队列为空！");
        }
      }
      
      leftIn.onclick = function() {
        if(input.value >= 10 && input.value <= 100) {
          queueIn("left", input.value);
        }else {
          alert("请输入10-100的数字！");
        }
      }
      
      rightIn.onclick = function() {
        if(input.value >= 10 && input.value <= 100) {
          queueIn("right", input.value);
        }else {
          alert("请输入10-100的数字！");
        }
      }
      
      leftOut.onclick = function() {
        queueOut("left");
      }
      
      rightOut.onclick = function() {
        queueOut("right");
      }
      
      sort.onclick = function() {
        if(!isSorted) {
          var lis = [].slice.call(queue.getElementsByTagName("li"));    //NodeList转Array
          var docfrag = document.createDocumentFragment();
          lis.sort(function(a, b) {
            return parseInt(a.style.height) - parseInt(b.style.height);
          });
          lis.forEach(function(element) {
            docfrag.appendChild(element);
          });
          queue.innerHTML = "";
          queue.appendChild(docfrag);
          isSorted = true;
        }
      }
    </script>
  </body>
</html>